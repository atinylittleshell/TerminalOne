make terminal tree management logic unit testable
